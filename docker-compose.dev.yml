# Development mode with hot reload
# Usage: docker compose -f docker-compose.dev.yml up

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - ./crates:/app/crates:cached
      - ./Cargo.toml:/app/Cargo.toml:ro
      - ./Cargo.lock:/app/Cargo.lock:ro
      - ./web/dist:/app/web/dist:ro
      - cargo-cache:/usr/local/cargo/registry
      - target-cache:/app/target
    environment:
      - RUST_LOG=debug
      - RUST_BACKTRACE=1

  frontend:
    image: node:20-alpine
    ports:
      - "5173:5173"
    working_dir: /app
    volumes:
      - ./web:/app:cached
      - node-modules:/app/node_modules
    command: sh -c "npm install && npm run dev -- --host"
    environment:
      - NODE_ENV=development
      - VITE_API_TARGET=http://backend:3000
      - VITE_API_URL=http://localhost:3000
    depends_on:
      - backend

volumes:
  cargo-cache:
  target-cache:
  node-modules:
